var RMS=function(){function e(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].join("_"));return t.join("-")}function t(e){var t,n=new Array;return n[0]=e>>>24>>>0,n[1]=e<<8>>>24>>>0,n[2]=e<<16>>>24,n[3]=e<<24>>>24,t=String(n[0])+"."+String(n[1])+"."+String(n[2])+"."+String(n[3])}function n(e,t){for(var n=[],o=0;o<e.length;o++){n[o]=[];for(var r=0;t>r;r++)n[o][r]=0}return n}function o(){document.addEventListener?(document.addEventListener("keydown",w,!1),document.addEventListener("keyup",w,!1)):(document.attachEvent("onkeydown",w),document.attachEvent("onkeyup",w))}var r,i,a=location.protocol+"//cdid.c-ctrip.com/model-poc2/h",c=location.protocol.replace("http","ws")+"//cdid.c-ctrip.com/model-poc2/w",d=!1,s=location.protocol+"//"+location.host,u=[["J_mobile","p_name_0","mobilephone","nloginname","givenName_0"],["pickupEmail","I_contact_phone","txtContactEMail","npwd","contactPhoneNum"],["p_card_no_0","card_number_1","card_number_2","card_number_3","card_number_4","card_number","cardNum_0_0"]],p=[["J_resident_1"],["J_resident_2"],["txtContactMobilePhone","J_mobile"]],f=[0,0,0],l=n(u,10),h=n(p,3),w=function(e){var t=e.target||e.srcElement;if(e.keyCode||e.ctrlKey||e.altKey||e.shiftKey){for(var n=-1,o=0;o<p.length;o++)for(var r=0;r<p[o].length;r++)if(p[o][r]==t.id){n=o;break}if(-1!=n)try{e.ctrlKey&&67==e.keyCode&&(h[n][0]=1),e.ctrlKey&&86==e.keyCode&&(h[n][1]=1),e.ctrlKey&&88==e.keyCode&&(h[n][2]=1)}catch(e){console.log(e)}n=-1;for(var o=0;o<u.length;o++)for(var r=0;r<u[o].length;r++)if(u[o][r]==t.id){n=o;break}if(-1!=n)try{var i=!1;e.ctrlKey&&67==e.keyCode&&(l[n][0]=1,i=!0),e.ctrlKey&&86==e.keyCode&&(l[n][1]=1,i=!0),e.ctrlKey&&88==e.keyCode&&(l[n][2]=1,i=!0),8==e.keyCode&&"keydown"==e.type&&(l[n][3]+=1,i=!0),0==f[n]?f[n]=1*new Date:l[n][4]=1*new Date-f[n],e.altKey&&"keydown"==e.type&&(l[n][6]=1,i=!0),e.shiftKey&&"keydown"==e.type&&(l[n][7]+=1,i=!0),e.shiftKey&&e.ctrlKey&&"keydown"==e.type&&(l[n][8]+=1,i=!0),e.ctrlKey&&32==e.keyCode&&(l[n][9]+=1,i=!0),i?l[n][5]+=1:"keydown"==e.type&&(l[n][5]+=1)}catch(e){console.log(e)}}};o();var m=function(){},g=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},v=function(){function e(e){this.init(e)}var t=window,n=function(){var e;return t.XMLHttpRequest&&"withCredentials"in new t.XMLHttpRequest?e=t.XMLHttpRequest:t.XDomainRequest&&(e=t.XDomainRequest),e}(),o=["head","get","post","put","delete"],r={};e.prototype.init=function(e){var t=this;t.xhr=new n,t.method=e.method,t.url=e.url,t.success=e.success,t.error=e.error;try{t.xhr.timeout=2e3,t.xhr.ontimeout=function(){},e.credentials===!0&&(t.xhr.withCredentials=!0)}catch(o){}var r=e.params?e.params:e.data;return t.headers=e.headers,t.send(r),t},e.prototype.send=function(e){var t=this;return void 0!==t.success&&(t.xhr.onload=function(){t.success.call(this,this.responseText)}),void 0!==t.error&&(t.xhr.error=function(){t.error.call(this,this.responseText)}),t.xhr.open(t.method,t.url,!0),void 0!==t.headers&&t.setHeaders(),e?t.xhr.send(e):t.xhr.send(),t},e.prototype.setHeaders=function(){var e,t=this,n=t.headers;try{for(e in n)n.hasOwnProperty(e)&&t.xhr.setRequestHeader(e,n[e])}catch(o){}return t};for(var i=0;i<o.length;i++)!function(){var t=o[i];r[t]=function(n,o){var r={};if(void 0===n)throw new Error("CORS: url must be defined");return"object"==typeof n?r=n:("function"==typeof o&&(r.success=o),r.url=n),r.method=t.toUpperCase(),new e(r).xhr}}();return r}(),_=function(){return!("XMLHttpRequest"in window&&"withCredentials"in new XMLHttpRequest)},y=function(e,t,n){var o=document.createElement("input");return o.type="hidden",o.name=t,o.value=n,o.id=t+"_d__",e.appendChild(o),o},k=function(e,t,n,o){if(d)return setTimeout(function(){k(e,t,n)},30);if(d=!0,_()){if(createIframe(),r.action=e,i.name=t,i.value=n,guid){var a=document.getElementById("guid_d__");a?a.value=guid:y(r,"guid",guid)}r.submit()}else{var c=t+"="+n+"&serverName="+s;v.post({url:e,credentials:!0,params:c,method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},success:function(e){d=!1,e?(m(e),o&&o(e,!0)):o&&o(e,!1)},error:function(){m("cors error"),d=!1,o&&o(data,!1)}})}},n=!1;return{init:function(e){if(!n){n=!0,e=e?e:{};var t=this;if(window.__bfi=window.__bfi||[],window.__bfi.push(["_getFP",function(e){t.fp=e},!1]),window.__bfi.push(["_getStatus",function(e){t.vid=e.vid},!1]),window.__bfi.push(["_getPageid",function(n,o){!n&&o&&(e.pageId||(e.pageId=o+"")),t.pageId=o}]),window&&window.location){var o=!0,r=/^https?:\/\/((ct\.ctrip\.com)|([0-9a-zA-Z\.]*ctripcorp\.))/,i=r.exec(window.location);o=!i,o||(r=/^https?:\/\/(([0-9a-zA-Z\.]*qa\.nt\.ctripcorp\.))/,i=r.exec(window.location),o=i),o&&!function(){var e="//webresource.c-ctrip.com/resaresonline/risk/ubtrms/d.min.6186d77f.js",t=10;setTimeout(function(){var t=document.createElement("script");t.type="text/javascript",t.id="rmsd__script",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+e,t.crossOrigin="anonymous";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},t),window.rmsd__startScriptLoad=1*new Date}()}var a=function(){var e=window.__rmsbfi||[],t=e.push=function(){for(var e=arguments,t=0,n=e.length,o=0;n>o;o++)try{if("function"==typeof e[o])e[o]();else if("[object Array]"===Object.prototype.toString.call(e[o])){if(2!=e[o].length)continue;var r=e[o][0],i=e[o][1];"string"==typeof r&&"_getRmsToken"===r&&"function"==typeof i&&i(RMS.getRmsToken())}}catch(a){t++}return t};for(window.__rmsbfi=e;e.length>0;)t(e.shift())};a()}},getRmsToken:function(){var n="fp="+(this.fp?this.fp:"");n+="&vid="+(this.vid?this.vid:""),n+="&pageId="+(this.pageId?this.pageId:"");var o=/\_RGUID=([a-z0-9\-]+)(;|$)/.exec(document.cookie),r=/guid\_\_=([a-z0-9\-]+)(;|$)/.exec(document.cookie);if(o&&o.length>1){var i=o[1].replace(/\-/g,"");n+="&r="+i}else if(r&&r.length>1){var i=r[1].replace(/\-/g,"");n+="&r="+i}else n+="&r="+window.CHLOROFP_STATUS;var a=window.CHLOROFP_IP;if(!a){var c=/\_RF1=([0-9\.]+)(;|$)/.exec(document.cookie);c&&c.length>1&&(a=c[1])}isNaN(Number(a))||(a=t(Number(a))),a&&(a=a.replace(/^\s+|\s+$/g,"")),n+="&ip="+a,n+="&rg="+window.RG_STA,n+="&kpData="+e([h[2]]),n+="&kpControl="+e([h[0],h[1]]),n+="&kpEmp="+e(l),n+="&screen="+screen.width+"x"+screen.height;var d=(new Date).getTimezoneOffset()/60;n+="&tz="+(0>d?"+":"-")+Math.abs(d),n+="&blang="+navigator.language||navigator.userLanguage,n+="&oslang="+navigator.language||navigator.systemLanguage,n+="&ua="+encodeURIComponent(navigator.userAgent);var s=/^https?:\/\/([a-zA-Z0-9.\-_]+)\/?/,u=s.exec(window.location);if(u&&u.length>1){var p=u[1];n+="&d="+encodeURIComponent(p)}return n+="&v=22",this.uuid&&(n+="&rmsId="+this.uuid),n},ping:function(e){if(window&&window.location&&"WebSocket"in window){var t=!0,n=/^https?:\/\/((ct\.ctrip\.com)|([0-9a-zA-Z\.]*ctripcorp\.))/,o=n.exec(window.location);if(t=!o){if(!e){var r=/\_RGUID=([a-z0-9\-]+)(;|$)/.exec(document.cookie),i=/guid\_\_=([a-z0-9\-]+)(;|$)/.exec(document.cookie);r&&r.length>1?e=r[1].replace(/\-/g,""):i&&i.length>1&&(e=i[1].replace(/\-/g,""))}if(e){e=e+"_"+g(1,100),m(e);var d=new WebSocket(c);d.addEventListener("open",function(){d.send(e)}),d.addEventListener("message",function(t){var n=t.data;m("websocket: ",n),"OK"===n?d.close():d.send(n+":"+e)}),window.RG_STA="b4",k(a,"requestId",e,function(e,t){t?(window.CHLOROFP_IP=window.CHLOROFP_IP||e,window.RG_STA="fin"):window.RG_STA="err"})}}}}}}();RMS.init(),RMS.ping();